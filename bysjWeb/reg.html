<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>养老院网站</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <link rel="stylesheet" type="text/css" href="css/reset.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.validate.min.js"></script>
</head>
<body class="login_bj" >
<div class="zhuce_body">
	<div class="logo"><a href="index.php"><img src="images/logo1.png" width="350" height="100" border="0" title="快乐养老院"></a></div>
    <div class="zhuce_kong">
    	<div class="zc">
        	<div class="bj_left">
            <h3>欢迎注册</h3>
       	  	  <form  id="formZ" name="formZ" action="#" method="post">
                <input type="text" id="username" name="username" class="kuang_txt phone" placeholder="账号">
                <input type="text" id="email" name="email" class="kuang_txt email" placeholder="邮箱">
                <input type="password" id="password" name="password" class="kuang_txt possword" placeholder="密码">
                <input type="password" id="confirm_password" name="confirm_password" class="kuang_txt possword" placeholder="确认密码">
                <!--<input name="" type="text" class="kuang_txt yanzm" placeholder="验证码">-->
                <div>
               		<input name="autoFlag" id="autoFlag" type="checkbox" checked="checked" value=""><span>已阅读并同意<a href="#" target="_blank"><span class="lan">《XXXXX使用协议》</span></a></span>
                </div>
                <input name="btn_zhuce" type="button" id="btn_zhuce" class="btn_zhuce" value="注册">
                <p id="createResult"></p>
                </form>
            </div><!--左框-->
        	<div class="bj_right">
            	<p>使用以下账号直接登录</p>
                <a href="#" class="zhuce_qq" title="QQ注册">QQ注册</a>
                <a href="#" class="zhuce_wb" title="微博注册">微博注册</a>
                <a href="#" class="zhuce_wx" title="微信注册">微信注册</a>
                <p>已有账号？<a href="login.html" title="立即登录">立即登录</a></p>
          </div><!--右框-->
        </div><!--注册框-->
      
    </div>
	  <div  class="banquan"><p>www.heguofeng.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;养老院网站</P></div>
</div>
<script type="text/javascript"> 
$().ready(function() {
		$("#btn_zhuce").click(function(){
			//先通过button验证表单有效性
			var flag = $('#formZ').valid();
	    	if(flag){
				$.ajax({
					type:"POST",
					//url:"login.php?username="+$("#username").val(),
					url:"doLogin.php?act=reg",
					data:{
						username:$("#username").val(),
						email:$("#email").val(),
						password:$("#password").val(),
						confirm_password:$("#confirm_password").val(),
						autoFlag:$("#autoFlag").is(':checked')
						},
					dataType:"json",
					success:function(data){
						if(data.success){
							$("#createResult").html(data.msg);
							setTimeout(function(){
								window.location='login.html';
							},3000);	
						}
						else{
							$("#createResult").html(data.msg);
						}
					},
					error:function(jqXHR){
						alert("发生错误:"+jqXHR.status);
					},
				});
			}
	});
	$("#username").focus();
	$("#username").blur(function(){
		$.ajax({
			type:"get",
			url:"doLogin.php?act=check",
			data:{
				username:$("#username").val()
			},
			dataType:'json',
			success:function(data){
				if(data.d==1){
					$("#createResult").html("已存在该用户名，请更换");
					$("#btn_zhuce").attr("disabled",true);
				}
				if(data.d==2){
					$("#createResult").html("用户名可用");
					$("#btn_zhuce").attr("disabled",false);
				}
			},
			error:function(jqXHR){
				alert("发生错误"+jqXHR.status);
			}
		});
	});
	
	$("#formZ").validate({	 	
	        rules: {
			    username: {
                    required: true,
                    minlength: 2,
                    maxlength: 10
                },
				email: {
				    required: true,
				    email: true
			   },
			   password: {
				    required: true,
				    minlength: 2
			   },
			   confirm_password: {
				    required: true,
				    minlength: 2,
				    equalTo: "#password"
			   }
	 		},
	        messages: 
	        {
			      username: {
                    required: '请输入用户名',
                    minlength: '账号不能小于2个字符',
                    maxlength: '账号不能超过10个字符',
                    remote: '账号不存在'
                },
			   email: {
				    required: "请输入Email地址",
				    email: "请输入正确的Email地址"
			   },
			   password: {
				    required: "请输入密码",
				    minlength: jQuery.format("密码不能小于{0}个字 符")
			   },
			   confirm_password: {
				    required: "请输入确认密码",
				    minlength: "确认密码不能小于2个字符",
				    equalTo: "两次输入密码不一致！"
			   }
	  		}	
	   	 });

});
</script>
</body>
</html>