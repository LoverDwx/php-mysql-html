<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>养老院网站登录</title>
	<link rel="shortcut icon" href="images/favicon.ico"/><!--加图标-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <link rel="stylesheet" type="text/css" href="css/reset.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.validate.min.js"></script>
    <script type="text/javascript" src="plugins/dialog.js"></script>
</head>
<body>
<div id="background"><img src="images/bg_login2.jpg" width="100%" height="100%"/></div><!--背景层-->
<div class="zhuce_body">
	<div class="logo"><a href="index.php"><img src="images/logo1.png" alt="logo" width="350" height="100" border="0"></a></div>
    <div class="zhuce_kong login_kuang">
    	<div class="zc">
        	<div class="bj_left"><!--左边输入框-->
	            <h3>登录</h3>
	       	  	  <form id="formD" name="formD" method="get" action="#">
		                <input type="text" id="username" name="username" class="kuang_txt" placeholder="请输入已验手机" onkeypress="dologin(event)">
		                <input type="password" id="password" name="password" class="kuang_txt" placeholder="请输入密码" onkeypress="dologin(event)">
		                <div>
		               		<a href="forget_pwd.html" title="忘记密码">忘记密码？</a><input id="autoFlag" name="autoFlag" type="checkbox" value=""><span>记住我</span> 
		                </div>
		                <input name="btn_denglu" type="button" id="btn_denglu" class="btn_denglu" value="登录">
		                <p id="createResult"></p>
		                <span class="save_start" style="display: none;margin-left: 50px;"> 正在登录 </span>
	              </form>
            </div>
        	<div class="bj_right">
            	<p>使用以下账号直接登录</p>
                <a href="javascript:;" class="zhuce_qq" title="QQ注册">QQ注册</a>
                <a href="javascript:;" class="zhuce_wb" title="微博注册">微博注册</a>
                <a href="javascript:;" class="zhuce_wx" title="微信注册">微信注册</a>
                <p>还没有账号？<a href="reg.html" title="立即注册">立即注册</a></p>            
            </div>
        </div>
    </div>
</div>
<script type="text/javascript"> 
$().ready(function() {
	$("#username").focus();

	$("#btn_denglu").click(function(){
		$(document).ajaxStart(function(){
			$(".save_start").css("display",'block');
			$("#createResult").css("display",'none');
		});
			var flag = $('#formD').valid();//验证表单有效性
	    	if(flag){
				$.ajax({
					type:"GET",
					//url:"login.php?username="+$("#username").val(),
					url:"doUserAction.php?act=login",
					data:{
						username:$("#username").val(),
						password:$("#password").val(),
						autoFlag:$("#autoFlag").is(':checked')
						},
					dataType:"json",
					success:function(data){
						if(data.success){
							$(".save_start").css("display",'none');
							$("#createResult").css({"display":'block',"color":"#228b22"});
							$("#createResult").html(data.msg);
							window.location="index.php";
						}
						else{
							$(".save_start").css("display",'none');
							$("#createResult").css({"display":'block',"color":"red"});
							$("#createResult").html(data.msg);
							setTimeout(function(){
								$("#createResult").css("display",'none');
							},2000);
							$("#password").val("");
						}
					},
					error:function(jqXHR){
						alert("发生错误:"+jqXHR.status);
					},
				});
			}
	});	 
		//表单验证	
	 $("#formD").validate({	
	        rules: {
			    username: {
                    required: true,
                    minlength: 2,
                    maxlength: 20
               },
			   password: {
				    required: true,
				    minlength: 2
			   },
	 		},
	        messages: 
	        {
			   username: {
                    required: '请输入用户名',
                    minlength: '账号不能小于2个字符',
                    maxlength: '账号不能超过20个字符',
                    remote: '账号不存在'
               },
			   password: {
				    required: "请输入密码",
				    minlength: jQuery.format("密码不能小于{0}个字 符")
			   }
	  		}	
	   });
	 
});
	function dologin(evt){
		evt=(evt)?evt:((window.event)?window.event:"");
		var key=evt.keyCode?evt.keyCode:evt.which;
		if(key==13){
			$("#btn_denglu").click();
		}
	}

</script>
</body>

</html>